<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Race Rally: Tables 2-5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 900px;
            width: 100%;
            padding: 20px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #FF6B35;
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #555;
            font-size: 18px;
        }

        .mute-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #FFD93D;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .mute-button:hover {
            transform: scale(1.1);
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #FFF4E0;
            border-radius: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B35;
        }

        .race-track {
            background: linear-gradient(to bottom, #90EE90 0%, #7CCD7C 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            min-height: 200px;
        }

        .finish-line {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
        }

        .racer {
            font-size: 48px;
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            transition: left 0.5s ease-out;
        }

        .progress-bar {
            background: white;
            border-radius: 10px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }

        .question-area {
            background: #F0F8FF;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-text {
            font-size: 36px;
            color: #333;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .answer-button {
            background: linear-gradient(135deg, #6B5B95 0%, #8B7BAA 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            min-height: 70px;
        }

        .answer-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .answer-button:active {
            transform: translateY(0);
        }

        .answer-button.correct {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
            animation: correctPulse 0.5s;
        }

        .answer-button.incorrect {
            background: linear-gradient(135deg, #F44336 0%, #E57373 100%);
            animation: shake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback.correct {
            background: #C8E6C9;
            color: #2E7D32;
        }

        .feedback.incorrect {
            background: #FFCDD2;
            color: #C62828;
        }

        .timer {
            font-size: 20px;
            color: #FF6B35;
            font-weight: bold;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .star {
            font-size: 32px;
            opacity: 0.3;
        }

        .star.earned {
            opacity: 1;
            animation: starPop 0.5s;
        }

        @keyframes starPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .start-screen, .end-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .start-screen h2, .end-screen h2 {
            color: #FF6B35;
            font-size: 36px;
            margin-bottom: 20px;
        }

        .start-screen p, .end-screen p {
            font-size: 20px;
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .big-button {
            background: linear-gradient(135deg, #FF6B35 0%, #FF8C5A 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px 40px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
            margin-top: 20px;
            min-width: 200px;
        }

        .big-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .big-button:active {
            transform: translateY(0);
        }

        .instructions {
            background: #FFF9E6;
            border-left: 5px solid #FFD93D;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: left;
        }

        .instructions ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .instructions li {
            margin: 8px 0;
            font-size: 16px;
            color: #555;
        }

        .hidden {
            display: none;
        }

        .score-summary {
            background: #E8F5E9;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .score-summary h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            font-size: 18px;
        }

        .celebration {
            font-size: 64px;
            margin: 20px 0;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 24px;
            }

            .question-text {
                font-size: 28px;
            }

            .answer-button {
                font-size: 22px;
                padding: 15px;
            }

            .racer {
                font-size: 36px;
            }

            .finish-line {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="mute-button" id="muteButton" aria-label="Toggle sound">üîä</button>

        <div class="header">
            <h1>üèÅ Multiplication Race Rally üèÅ</h1>
            <p>Help your animal racer reach the finish line!</p>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="start-screen">
            <h2>Welcome to the Race! ü¶Å</h2>
            <div class="instructions">
                <strong>How to Play:</strong>
                <ul>
                    <li>Answer multiplication problems to move your racer forward</li>
                    <li>You'll practice times tables 2, 3, 4, and 5</li>
                    <li>Get 10 questions right to reach the finish line</li>
                    <li>Earn stars for correct answers!</li>
                    <li>Try to beat your best time!</li>
                </ul>
            </div>
            <p>üêÜ Choose your racer and let's go! üêÜ</p>
            <button class="big-button" id="startButton">Start Racing!</button>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Correct</div>
                    <div class="stat-value" id="correct">0/10</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Time</div>
                    <div class="stat-value timer" id="timer">0:00</div>
                </div>
            </div>

            <div class="race-track">
                <div class="racer" id="racer">ü¶Å</div>
                <div class="finish-line">üèÅ</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>

            <div class="question-area">
                <div class="question-text" id="question">2 √ó 3 = ?</div>
                <div class="answers-grid" id="answersGrid">
                    <button class="answer-button" tabindex="0">6</button>
                    <button class="answer-button" tabindex="0">8</button>
                    <button class="answer-button" tabindex="0">10</button>
                    <button class="answer-button" tabindex="0">12</button>
                </div>
                <div class="feedback" id="feedback"></div>
            </div>

            <div class="stars" id="stars">
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
            </div>
        </div>

        <!-- End Screen -->
        <div id="endScreen" class="hidden end-screen">
            <div class="celebration">üéâ</div>
            <h2>Amazing Race!</h2>
            <div class="score-summary">
                <h3>Your Results:</h3>
                <div class="score-item">
                    <span>Questions Correct:</span>
                    <span id="finalCorrect">0/10</span>
                </div>
                <div class="score-item">
                    <span>Total Score:</span>
                    <span id="finalScore">0</span>
                </div>
                <div class="score-item">
                    <span>Time Taken:</span>
                    <span id="finalTime">0:00</span>
                </div>
                <div class="score-item">
                    <span>Stars Earned:</span>
                    <span id="finalStars">‚≠ê‚≠ê‚≠ê</span>
                </div>
            </div>
            <p id="encouragement">You're a multiplication champion! üèÜ</p>
            <button class="big-button" id="playAgainButton">Race Again!</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            score: 0,
            correctAnswers: 0,
            totalQuestions: 10,
            currentQuestion: 0,
            startTime: null,
            timerInterval: null,
            soundEnabled: true,
            starsEarned: 0
        };

        const racers = ['ü¶Å', 'üêÜ', 'üêé', 'ü¶ò', 'üêï'];
        let currentRacer = racers[Math.floor(Math.random() * racers.length)];

        // DOM Elements
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const endScreen = document.getElementById('endScreen');
        const startButton = document.getElementById('startButton');
        const playAgainButton = document.getElementById('playAgainButton');
        const muteButton = document.getElementById('muteButton');
        const questionEl = document.getElementById('question');
        const answersGrid = document.getElementById('answersGrid');
        const feedbackEl = document.getElementById('feedback');
        const scoreEl = document.getElementById('score');
        const correctEl = document.getElementById('correct');
        const timerEl = document.getElementById('timer');
        const racerEl = document.getElementById('racer');
        const progressFill = document.getElementById('progressFill');
        const starsContainer = document.getElementById('stars');

        // Sound Effects (using Web Audio API)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (!gameState.soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } else if (type === 'win') {
                const notes = [523.25, 587.33, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
                    osc.start(audioContext.currentTime + i * 0.15);
                    osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
                });
            }
        }

        // Generate Question
        function generateQuestion() {
            const tables = [2, 3, 4, 5];
            const num1 = tables[Math.floor(Math.random() * tables.length)];
            const num2 = Math.floor(Math.random() * 10) + 1;
            const correctAnswer = num1 * num2;

            // Generate wrong answers
            const wrongAnswers = new Set();
            while (wrongAnswers.size < 3) {
                const offset = Math.floor(Math.random() * 10) - 5;
                const wrongAnswer = correctAnswer + offset;
                if (wrongAnswer !== correctAnswer && wrongAnswer > 0) {
                    wrongAnswers.add(wrongAnswer);
                }
            }

            const allAnswers = [correctAnswer, ...Array.from(wrongAnswers)];
            
            // Shuffle answers
            for (let i = allAnswers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allAnswers[i], allAnswers[j]] = [allAnswers[j], allAnswers[i]];
            }

            return {
                question: `${num1} √ó ${num2} = ?`,
                correctAnswer: correctAnswer,
                answers: allAnswers
            };
        }

        // Display Question
        function displayQuestion() {
            const q = generateQuestion();
            questionEl.textContent = q.question;
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';

            answersGrid.innerHTML = '';
            q.answers.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'answer-button';
                button.textContent = answer;
                button.tabIndex = 0;
                button.setAttribute('aria-label', `Answer ${answer}`);
                button.addEventListener('click', () => checkAnswer(answer, q.correctAnswer, button));
                button.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        checkAnswer(answer, q.correctAnswer, button);
                    }
                });
                answersGrid.appendChild(button);
            });
        }

        // Check Answer
        function checkAnswer(selected, correct, button) {
            const buttons = answersGrid.querySelectorAll('.answer-button');
            buttons.forEach(btn => btn.disabled = true);

            if (selected === correct) {
                button.classList.add('correct');
                feedbackEl.textContent = getEncouragement();
                feedbackEl.className = 'feedback correct';
                gameState.score += 10;
                gameState.correctAnswers++;
                gameState.starsEarned++;
                playSound('correct');
                updateStars();
                moveRacer();
            } else {
                button.classList.add('incorrect');
                feedbackEl.textContent = `Not quite! The answer is ${correct}. Keep trying!`;
                feedbackEl.className = 'feedback incorrect';
                playSound('incorrect');
                
                // Highlight correct answer
                buttons.forEach(btn => {
                    if (parseInt(btn.textContent) === correct) {
                        btn.classList.add('correct');
                    }
                });
            }

            updateStats();

            setTimeout(() => {
                gameState.currentQuestion++;
                if (gameState.currentQuestion < gameState.totalQuestions) {
                    displayQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }

        // Get Encouragement
        function getEncouragement() {
            const messages = [
                "Awesome! üåü",
                "You're on fire! üî•",
                "Fantastic work! üéâ",
                "Keep it up! üí™",
                "Amazing! üåà",
                "You're a math star! ‚≠ê",
                "Brilliant! üé®",
                "Super job! ü¶∏",
                "Outstanding! üèÜ",
                "You got it! üéØ"
            ];
            return messages[Math.floor(Math.random() * messages.length)];
        }

        // Update Stats
        function updateStats() {
            scoreEl.textContent = gameState.score;
            correctEl.textContent = `${gameState.correctAnswers}/${gameState.totalQuestions}`;
            
            const progress = (gameState.currentQuestion / gameState.totalQuestions) * 100;
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
        }

        // Move Racer
        function moveRacer() {
            const maxDistance = 85;
            const progress = (gameState.correctAnswers / gameState.totalQuestions) * maxDistance;
            racerEl.style.left = `${progress}%`;
        }

        // Update Stars
        function updateStars() {
            const stars = starsContainer.querySelectorAll('.star');
            const starsToShow = Math.min(Math.floor(gameState.starsEarned / 3), 3);
            stars.forEach((star, index) => {
                if (index < starsToShow) {
                    star.classList.add('earned');
                }
            });
        }

        // Timer
        function startTimer() {
            gameState.startTime = Date.now();
            gameState.timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(gameState.timerInterval);
        }

        // Start Game
        function startGame() {
            gameState = {
                score: 0,
                correctAnswers: 0,
                totalQuestions: 10,
                currentQuestion: 0,
                startTime: null,
                timerInterval: null,
                soundEnabled: gameState.soundEnabled,
                starsEarned: 0
            };

            currentRacer = racers[Math.floor(Math.random() * racers.length)];
            racerEl.textContent = currentRacer;
            racerEl.style.left = '20px';

            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            updateStats();
            displayQuestion();
            startTimer();

            // Reset stars
            const stars = starsContainer.querySelectorAll('.star');
            stars.forEach(star => star.classList.remove('earned'));
        }

        // End Game
        function endGame() {
            stopTimer();
            playSound('win');

            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            document.getElementById('finalCorrect').textContent = `${gameState.correctAnswers}/${gameState.totalQuestions}`;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalTime').textContent = timeString;

            const starsEarned = Math.min(Math.floor(gameState.starsEarned / 3), 3);
            document.getElementById('finalStars').textContent = '‚≠ê'.repeat(starsEarned);

            const encouragement = document.getElementById('encouragement');
            if (gameState.correctAnswers === gameState.totalQuestions) {
                encouragement.textContent = "Perfect score! You're a multiplication master! üèÜ";
            } else if (gameState.correctAnswers >= 7) {
                encouragement.textContent = "Great job! You're really getting the hang of this! üåü";
            } else if (gameState.correctAnswers >= 5) {
                encouragement.textContent = "Good effort! Keep practicing and you'll be amazing! üí™";
            } else {
                encouragement.textContent = "Nice try! Practice makes perfect! Keep going! üéØ";
            }

            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
        }

        // Mute Button
        muteButton.addEventListener('click', () => {
            gameState.soundEnabled = !gameState.soundEnabled;
            muteButton.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
        });

        // Event Listeners
        startButton.addEventListener('click', startGame);
        playAgainButton.addEventListener('click', startGame);

        // Keyboard navigation for start button
        startButton.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                startGame();
            }
        });

        playAgainButton.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                startGame();
            }
        });
    </script>
</body>
</html>